{
  "description": "Example flow with in-queue callback requests",
  "states": [
    {
      "name": "Trigger",
      "type": "trigger",
      "transitions": [
        {
          "event": "incomingMessage"
        },
        {
          "next": "Generate_Profile_URL",
          "event": "incomingCall"
        },
        {
          "event": "incomingConversationMessage"
        },
        {
          "event": "incomingRequest"
        },
        {
          "event": "incomingParent"
        }
      ],
      "properties": {
        "offset": {
          "x": 0,
          "y": -10
        }
      }
    },
    {
      "name": "Generate_Profile_URL",
      "type": "run-function",
      "transitions": [
        {
          "next": "SendCallToAgent",
          "event": "success"
        },
        {
          "next": "SendCallToAgent_Fallback",
          "event": "fail"
        }
      ],
      "properties": {
        "offset": {
          "x": 240,
          "y": 100
        },
        "url": "https://connie-profiles-v01-6987.twil.io/features/generate-profile-url",
        "method": "GET",
        "parameters": [
          {
            "value": "{{trigger.call.From}}",
            "key": "phoneNumber"
          }
        ]
      }
    },
    {
      "name": "SendCallToAgent",
      "type": "send-to-flex",
      "transitions": [
        {
          "event": "callComplete"
        },
        {
          "event": "failedToEnqueue"
        },
        {
          "event": "callFailure"
        }
      ],
      "properties": {
        "waitUrl": "https://custom-flex-extensions-serverless-8158-dev.twil.io/features/callback-and-voicemail/studio/wait-experience",
        "offset": {
          "x": 110,
          "y": 240
        },
        "workflow": "WWd01822d5be62af0fa0bef6c4ad7d0dfa",
        "channel": "TCb732fdada36d93d7d7bf684e75a07b8f",
        "attributes": "{ \"type\": \"inbound\", \"name\": \"{{trigger.call.From}}\", \"call_sid\": \"{{trigger.call.CallSid}}\", \"crm_url\": \"{{widgets.Generate_Profile_URL.parsed.crm_url}}\", \"conversations\": {\"hang_up_by\": \"Customer\"} }",
        "waitUrlMethod": "POST"
      }
    },
    {
      "name": "SendCallToAgent_Fallback",
      "type": "send-to-flex",
      "transitions": [
        {
          "event": "callComplete"
        },
        {
          "event": "failedToEnqueue"
        },
        {
          "event": "callFailure"
        }
      ],
      "properties": {
        "waitUrl": "https://custom-flex-extensions-serverless-8158-dev.twil.io/features/callback-and-voicemail/studio/wait-experience",
        "offset": {
          "x": 370,
          "y": 240
        },
        "workflow": "WWd01822d5be62af0fa0bef6c4ad7d0dfa",
        "channel": "TCb732fdada36d93d7d7bf684e75a07b8f",
        "attributes": "{ \"type\": \"inbound\", \"name\": \"{{trigger.call.From}}\", \"call_sid\": \"{{trigger.call.CallSid}}\", \"crm_url\": \"https://connie-profiles-v01-6987.twil.io/profile-view?phone={{trigger.call.From | url_encode}}\", \"conversations\": {\"hang_up_by\": \"Customer\"} }",
        "waitUrlMethod": "POST"
      }
    }
  ],
  "initial_state": "Trigger",
  "flags": {
    "allow_concurrent_calls": true
  }
}
